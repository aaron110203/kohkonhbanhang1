<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸš€ DEMO UPLOAD áº¢NH - Tá»± Äá»™ng ÄÄƒng Nháº­p</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 10px;
    }
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
    }
    .info {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    .success {
      background: #d4edda;
      border-left: 4px solid #28a745;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      color: #155724;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }
    input[type="text"], input[type="number"], select, textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 1rem;
    }
    input[type="file"] {
      width: 100%;
      padding: 12px;
      border: 2px dashed #667eea;
      border-radius: 10px;
      background: #f8f9fa;
      cursor: pointer;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
    }
    .radio-group {
      margin-bottom: 15px;
    }
    .radio-group label {
      display: inline-block;
      margin-right: 20px;
      font-weight: normal;
      cursor: pointer;
    }
    .radio-group input[type="radio"] {
      margin-right: 5px;
      cursor: pointer;
    }
    .preview-box {
      margin-top: 15px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      border: 2px solid #667eea;
      display: none;
    }
    .preview-box img {
      max-width: 100%;
      max-height: 300px;
      border-radius: 10px;
      display: block;
      margin: 10px auto;
    }
    .preview-info {
      margin-top: 10px;
      padding: 10px;
      background: white;
      border-radius: 8px;
      font-size: 0.9rem;
      color: #666;
    }
    button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }
    button:hover {
      transform: scale(1.02);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .product-preview {
      margin-top: 20px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      display: none;
    }
    .product-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .product-card img {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    .product-name {
      font-size: 1.5rem;
      font-weight: bold;
      color: #333;
      margin-bottom: 10px;
    }
    .product-price {
      font-size: 1.3rem;
      color: #667eea;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .product-desc {
      color: #666;
      line-height: 1.6;
      margin-bottom: 10px;
    }
    .btn-link {
      display: inline-block;
      padding: 10px 20px;
      background: #667eea;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      margin: 5px;
      transition: background 0.2s;
    }
    .btn-link:hover {
      background: #764ba2;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš€ DEMO UPLOAD áº¢NH Sáº¢N PHáº¨M</h1>
    <p class="subtitle">Tá»± Ä‘á»™ng Ä‘Äƒng nháº­p â†’ Upload áº£nh â†’ Xem káº¿t quáº£</p>

    <div class="success" id="login-status">
      <strong>âœ… Äang tá»± Ä‘á»™ng Ä‘Äƒng nháº­p...</strong>
    </div>

    <form id="productForm">
      <div class="form-group">
        <label>ğŸ“ TÃªn Sáº£n Pháº©m *</label>
        <input type="text" id="product-name" placeholder="VD: Gáº¡o ThÆ¡m ST25" required value="Gáº¡o ThÆ¡m ST25">
      </div>

      <div class="form-group">
        <label>ğŸ’° GiÃ¡ (â‚­) *</label>
        <input type="number" id="product-price" placeholder="VD: 45000" required value="45000">
      </div>

      <div class="form-group">
        <label>ğŸ·ï¸ Danh Má»¥c *</label>
        <select id="product-category" required>
          <option value="food" selected>ğŸš Äá»“ Ä‚n</option>
          <option value="fashion">ğŸ‘• Thá»i Trang</option>
          <option value="medicine">ğŸ’Š Thuá»‘c</option>
          <option value="personal">ğŸ§´ ChÄƒm SÃ³c</option>
          <option value="grocery">ğŸ›’ Táº¡p HÃ³a</option>
          <option value="fruits">ğŸ TrÃ¡i CÃ¢y</option>
          <option value="drinks">ğŸ¥¤ Äá»“ Uá»‘ng</option>
          <option value="electronics">ğŸ“± Äiá»‡n Tá»­</option>
        </select>
      </div>

      <div class="form-group">
        <label>ğŸ“± Telegram LiÃªn Há»‡</label>
        <input type="text" id="product-telegram" placeholder="@username" value="@ADSaaron99">
      </div>

      <div class="form-group">
        <label>ğŸ“¸ Chá»n PhÆ°Æ¡ng Thá»©c Upload *</label>
        <div class="radio-group">
          <label>
            <input type="radio" name="upload-method" value="base64" checked>
            <strong style="color: #667eea;">ğŸ’¾ LÆ°u Base64 (KhÃ´ng cáº§n server)</strong>
          </label>
          <label>
            <input type="radio" name="upload-method" value="server">
            <strong style="color: #28a745;">ğŸ“¤ Upload lÃªn Server</strong>
          </label>
        </div>
      </div>

      <div class="form-group">
        <label>ğŸ“· Chá»n áº¢nh Sáº£n Pháº©m * (JPG, PNG, GIF - Tá»‘i Ä‘a 5MB)</label>
        <input type="file" id="product-image" accept="image/*" required>
        
        <div class="preview-box" id="preview-box">
          <h3 style="color: #333; margin-bottom: 10px;">ğŸ‘ï¸ Xem TrÆ°á»›c:</h3>
          <img id="preview-img" alt="Preview">
          <div class="preview-info" id="preview-info"></div>
        </div>
      </div>

      <div class="form-group">
        <label>ğŸ“„ MÃ´ Táº£ / Cháº¥t LÆ°á»£ng</label>
        <textarea id="product-description" rows="3" placeholder="VD: Gáº¡o thÆ¡m cao cáº¥p, cháº¥t lÆ°á»£ng A1">Gáº¡o thÆ¡m cao cáº¥p, cháº¥t lÆ°á»£ng A1, háº¡t dÃ i, thÆ¡m ngon</textarea>
      </div>

      <button type="submit">ğŸ’¾ ThÃªm Sáº£n Pháº©m</button>
    </form>

    <div class="product-preview" id="product-preview">
      <h2 style="margin-bottom: 15px; color: #333;">âœ… Sáº£n Pháº©m ÄÃ£ ThÃªm ThÃ nh CÃ´ng!</h2>
      <div class="product-card" id="product-card"></div>
      
      <div style="text-align: center; margin-top: 20px;">
        <a href="products.html" target="_blank" class="btn-link">ğŸ›’ Xem Trang Sáº£n Pháº©m</a>
        <a href="dashboard.html" target="_blank" class="btn-link">ğŸ“Š VÃ o Dashboard</a>
        <button type="button" onclick="location.reload()" class="btn-link" style="border: none; cursor: pointer;">ğŸ”„ ThÃªm Sáº£n Pháº©m KhÃ¡c</button>
      </div>
    </div>
  </div>

  <script>
    let currentUser = null;
    let imageBase64 = null;

    // Auto login on page load
    window.addEventListener('load', function() {
      autoLogin();
      setupImagePreview();
      setupForm();
    });

    function autoLogin() {
      // Kiá»ƒm tra Ä‘Ã£ cÃ³ user chÆ°a
      const existingUser = localStorage.getItem('currentUser');
      
      if (existingUser) {
        currentUser = JSON.parse(existingUser);
        document.getElementById('login-status').innerHTML = `
          <strong>âœ… ÄÃ£ Ä‘Äƒng nháº­p:</strong> ${currentUser.fullname} (@${currentUser.username})
        `;
        return;
      }

      // Táº¡o user demo
      const demoUser = {
        id: 'demo_' + Date.now(),
        fullname: 'Demo User',
        username: 'demouser',
        password: '123456',
        telegram: '@ADSaaron99',
        role: 'agent',
        products: [],
        isActive: true,
        createdAt: new Date().toISOString()
      };

      // LÆ°u vÃ o agents
      let agents = JSON.parse(localStorage.getItem('agents')) || [];
      const existingAgent = agents.find(a => a.username === 'demouser');
      
      if (!existingAgent) {
        agents.push(demoUser);
        localStorage.setItem('agents', JSON.stringify(agents));
      } else {
        currentUser = existingAgent;
      }

      // ÄÄƒng nháº­p
      localStorage.setItem('currentUser', JSON.stringify(demoUser));
      currentUser = demoUser;

      document.getElementById('login-status').innerHTML = `
        <strong>âœ… Tá»± Ä‘á»™ng Ä‘Äƒng nháº­p thÃ nh cÃ´ng!</strong><br>
        TÃ i khoáº£n: ${demoUser.fullname} (@${demoUser.username})
      `;
    }

    function setupImagePreview() {
      const fileInput = document.getElementById('product-image');
      const previewBox = document.getElementById('preview-box');
      const previewImg = document.getElementById('preview-img');
      const previewInfo = document.getElementById('preview-info');

      fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        
        if (!file) {
          previewBox.style.display = 'none';
          return;
        }

        // Kiá»ƒm tra kÃ­ch thÆ°á»›c
        if (file.size > 5 * 1024 * 1024) {
          alert('âš ï¸ áº¢nh quÃ¡ lá»›n! Vui lÃ²ng chá»n áº£nh nhá» hÆ¡n 5MB');
          fileInput.value = '';
          previewBox.style.display = 'none';
          return;
        }

        // Kiá»ƒm tra loáº¡i file
        if (!file.type.startsWith('image/')) {
          alert('âš ï¸ Vui lÃ²ng chá»n file áº£nh (JPG, PNG, GIF)');
          fileInput.value = '';
          previewBox.style.display = 'none';
          return;
        }

        // Äá»c vÃ  hiá»ƒn thá»‹ preview
        const reader = new FileReader();
        reader.onload = function(event) {
          imageBase64 = event.target.result;
          previewImg.src = imageBase64;
          previewBox.style.display = 'block';
          
          const sizeKB = (file.size / 1024).toFixed(2);
          const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
          
          previewInfo.innerHTML = `
            <strong>ğŸ“ TÃªn file:</strong> ${file.name}<br>
            <strong>ğŸ“ KÃ­ch thÆ°á»›c:</strong> ${sizeKB} KB (${sizeMB} MB)<br>
            <strong>ğŸ¨ Loáº¡i:</strong> ${file.type}<br>
            <strong>âœ… Tráº¡ng thÃ¡i:</strong> <span style="color: #28a745; font-weight: bold;">ÄÃ£ chá»n thÃ nh cÃ´ng!</span>
          `;
        };
        reader.readAsDataURL(file);
      });
    }

    function setupForm() {
      const form = document.getElementById('productForm');
      
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        if (!currentUser) {
          alert('âŒ ChÆ°a Ä‘Äƒng nháº­p!');
          autoLogin();
          return;
        }

        if (!imageBase64) {
          alert('âŒ Vui lÃ²ng chá»n áº£nh sáº£n pháº©m!');
          return;
        }

        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        submitBtn.disabled = true;
        submitBtn.textContent = 'â³ Äang lÆ°u...';

        try {
          const uploadMethod = document.querySelector('input[name="upload-method"]:checked').value;
          let imageUrl = imageBase64;

          if (uploadMethod === 'server') {
            // Upload lÃªn server
            submitBtn.textContent = 'ğŸ“¤ Äang upload áº£nh...';
            
            const formData = new FormData();
            formData.append('image', document.getElementById('product-image').files[0]);
            
            try {
              const response = await fetch('https://kohkonhbanhang1.onrender.com/api/upload/image', {
                method: 'POST',
                body: formData
              });
              
              if (response.ok) {
                const result = await response.json();
                imageUrl = result.fullUrl;
                console.log('âœ… Upload server thÃ nh cÃ´ng:', imageUrl);
              } else {
                throw new Error('Server upload failed');
              }
            } catch (err) {
              console.warn('âš ï¸ Upload server tháº¥t báº¡i, dÃ¹ng Base64 thay tháº¿');
              alert('âš ï¸ Server Ä‘ang báº£o trÃ¬, sáº½ dÃ¹ng Base64 Ä‘á»ƒ lÆ°u áº£nh');
              imageUrl = imageBase64;
            }
          }

          const product = {
            id: 'product_' + Date.now(),
            name: document.getElementById('product-name').value.trim(),
            price: parseFloat(document.getElementById('product-price').value),
            category: document.getElementById('product-category').value,
            icon: getCategoryIcon(document.getElementById('product-category').value),
            description: document.getElementById('product-description').value.trim(),
            telegram: document.getElementById('product-telegram').value.trim() || currentUser.telegram,
            imageUrl: imageUrl,
            uploadMethod: uploadMethod,
            agentId: currentUser.id,
            agentName: currentUser.fullname,
            agentTelegram: currentUser.telegram,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
          };

          // LÆ°u vÃ o agents
          const agents = JSON.parse(localStorage.getItem('agents')) || [];
          const agentIndex = agents.findIndex(a => a.username === currentUser.username);

          if (agentIndex !== -1) {
            if (!agents[agentIndex].products) {
              agents[agentIndex].products = [];
            }
            agents[agentIndex].products.push(product);
            localStorage.setItem('agents', JSON.stringify(agents));

            // Cáº­p nháº­t currentUser
            currentUser.products = agents[agentIndex].products;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));

            // Hiá»ƒn thá»‹ preview sáº£n pháº©m
            showProductPreview(product);

          } else {
            throw new Error('KhÃ´ng tÃ¬m tháº¥y agent!');
          }

        } catch (error) {
          console.error('âŒ Lá»—i:', error);
          alert('âŒ CÃ³ lá»—i xáº£y ra: ' + error.message);
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
        }
      });
    }

    function getCategoryIcon(category) {
      const icons = {
        food: 'ğŸš',
        fashion: 'ğŸ‘•',
        medicine: 'ğŸ’Š',
        personal: 'ğŸ§´',
        grocery: 'ğŸ›’',
        fruits: 'ğŸ',
        drinks: 'ğŸ¥¤',
        electronics: 'ğŸ“±'
      };
      return icons[category] || 'ğŸ“¦';
    }

    function getCategoryName(category) {
      const names = {
        food: 'ğŸš Äá»“ Ä‚n',
        fashion: 'ğŸ‘• Thá»i Trang',
        medicine: 'ğŸ’Š Thuá»‘c',
        personal: 'ğŸ§´ ChÄƒm SÃ³c',
        grocery: 'ğŸ›’ Táº¡p HÃ³a',
        fruits: 'ğŸ TrÃ¡i CÃ¢y',
        drinks: 'ğŸ¥¤ Äá»“ Uá»‘ng',
        electronics: 'ğŸ“± Äiá»‡n Tá»­'
      };
      return names[category] || category;
    }

    function showProductPreview(product) {
      const preview = document.getElementById('product-preview');
      const card = document.getElementById('product-card');

      card.innerHTML = `
        <img src="${product.imageUrl}" alt="${product.name}">
        <div class="product-name">${product.icon} ${product.name}</div>
        <div class="product-price">${product.price.toLocaleString('vi-VN')} â‚­</div>
        <div style="margin-bottom: 10px; color: #666;">
          <strong>Danh má»¥c:</strong> ${getCategoryName(product.category)}
        </div>
        <div class="product-desc">${product.description}</div>
        <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px; font-size: 0.9rem; color: #666;">
          <strong>ğŸ‘¤ Äáº¡i lÃ½:</strong> ${product.agentName}<br>
          <strong>ğŸ“± Telegram:</strong> ${product.telegram}<br>
          <strong>ğŸ’¾ PhÆ°Æ¡ng thá»©c:</strong> ${product.uploadMethod === 'server' ? 'ğŸ“¤ Upload Server' : 'ğŸ’¾ Base64 LocalStorage'}
        </div>
      `;

      document.getElementById('productForm').style.display = 'none';
      preview.style.display = 'block';
      preview.scrollIntoView({ behavior: 'smooth' });
    }
  </script>
</body>
</html>
